<HTML><HEAD><TITLE>[ruby-dev:46547] ベンチマークが終わらない</TITLE>
<script language="javascript">
<!--
  function chk() {
    var name = navigator.appName;
    var ver = navigator.appVersion;
    if (name.charAt(0) == "M") {
      if (ver.charAt(0) >= 5 ||
        ver.indexOf(" 5.5") >= 0 ||
        ver.indexOf(" 6") >= 0
         )
        return(true);
      return(false);
    } else if (name.charAt(0) == "N") {
      if (ver.charAt(0) >= 5)
        return(true);
      return(false);
    } else {
      return(false);
    }
  }

  function hilight(x) {
    if (!chk()) return;
    if (parent) {
      try {
        parent.frames[0].hilight(x);
      } catch(e) {
       //alert(e);
      }
    }
  }

  //Navigation Bar
  var IE = document.all;
  var PosTimer;
  function stickNavi() {
    var y = document.body.scrollTop;
    var s = document.getElementById('navi').style
    s.top = y + 7;
    s.left = 8;
  }
  function stickNaviLoop() {
    if (PosTimer){clearTimeout(PosTimer);}
    stickNavi();
    PosTimer = setTimeout("stickNaviLoop()", 10);
  }

  function setNavi() {
    if (IE) {document.body.onscroll = stickNavi;}
    else {stickNaviLoop();}
  }

//-->
</script>
<link rel="stylesheet" href="http://blade.nagaokaut.ac.jp/css/blade-old.css" type="text/css" title="blade"></HEAD><BODY onLoad="setNavi()">
<A NAME=head></A><div id="navi" style="position:absolute;top:7px;left:8px;"><A HREF="46546" class="a-button" onclick="hilight(46546)"><span id="normal" title="&lt;">&nbsp;&lt;&nbsp;</span></A><A HREF="/ruby/ruby-dev/46401-46600.shtml#46547" class="a-button" target="_top"><span id="normal" title="^">^</span></A><A HREF="46548" class="a-button" onclick="hilight(46548)"><span id="normal" title="&gt;">&nbsp;&gt;&nbsp;</span></A> <a href="46546" onclick="hilight(46546)" class="a-button"><span id="red" title="[previous]">&nbsp;P&nbsp;</span></a><a href="46548" onclick="hilight(46548)" class="a-button"><span id="green" title="[next]">&nbsp;N&nbsp;</span></a> <a href="46546" onclick="hilight(46546)" class="a-button"><span id="red" title="[previous thread]">|&lt;</span></a><a href="46551" onclick="hilight(46551)" class="a-button"><span id="red" title="[next thread]">&gt;|</span></a><span id="normal" title="[parent]">^</span><a href="46548" onclick="hilight(46548)" class="a-button"><span id="normal" title="[child]">_</span></a><span id="normal" title="[elder]">&gt;</span><span id="normal" title="[younger]">&lt;</span> <a href="/cgi-bin/vframe.rb/ruby/ruby-dev/46547?46402-46608" target="_top" class="a-button"><span id="normal" title="[thread frame]">---</span></a><a href="/cgi-bin/vframe.rb/ruby/ruby-dev/46547?46402-46608+split-mode-vertical" target="_top" class="a-button"><span id="normal" title="[thread frame vertical]">&nbsp;|&nbsp;</span></a><a href="46547" target="_top" onclick="hilight(46547)" class="a-button"><span id="normal" title="[frame close]">&nbsp;~&nbsp;</span></a><a href="/ruby/ruby-dev/index.shtml" target="_top" class="a-button"><span id="normal" title="[index]">.</span></a><a href="/ruby/ruby-dev/../index.shtml" target="_top" class="a-button"><span id="normal" title="[iindex]">..</span></a><a href="/cgi-bin/scat.rb/ruby/ruby-dev/46547?help" class="a-button"><span id="normal" title="[Help]">Help</span></a></div>
<div id="header"><br>
Subject: [ruby-dev:<strong>46547</strong>] <strong>ベンチマークが終わらない</strong><br>
From: <strong>SASADA Koichi </strong>&lt;ko1 atdot.net&gt;<br>
Date: Tue, 20 Nov 2012 07:36:44 +0900</div>
<pre>shugo さんの refinement の修正についてベンチマークを取ろうと，昨日からす
べてのベンチマークを走らせたところ，普段なら数時間で終わるのですが，今見
たら終わってませんでした．

&gt; <span style="color: #007700;">so_nsieve_bits</span>
&gt; 
&gt; <span style="color: #007700;">#!/usr/bin/ruby</span>
&gt; <span style="color: #007700;">#</span>
&gt; <span style="color: #007700;"># The Great Computer Language Shootout</span>
&gt; <span style="color: #007700;"># <A HREF="http://shootout.alioth.debian.org/" target="_top">http://shootout.alioth.debian.org/</A></span>
&gt; <span style="color: #007700;">#</span>
&gt; <span style="color: #007700;"># nsieve-bits in Ruby</span>
&gt; <span style="color: #007700;"># Contributed by Glenn Parker, March 2005</span>
&gt; 
&gt; <span style="color: #007700;">CharExponent = 3</span>
&gt; <span style="color: #007700;">BitsPerChar = 1 &lt;&lt; CharExponent</span>
&gt; <span style="color: #007700;">LowMask = BitsPerChar - 1</span>
&gt; 
&gt; <span style="color: #007700;">def sieve(m)</span>
&gt;   <span style="color: #007700;">items = &quot;\xFF&quot; * ((m / BitsPerChar) + 1)</span>
&gt;   <span style="color: #007700;">masks = &quot;&quot;</span>
&gt;   <span style="color: #007700;">BitsPerChar.times do |b|</span>
&gt;     <span style="color: #007700;">masks &lt;&lt; (1 &lt;&lt; b).chr</span>
&gt;   <span style="color: #007700;">end</span>
&gt; 
&gt;   <span style="color: #007700;">count = 0</span>
&gt;   <span style="color: #007700;">pmax = m - 1</span>
&gt;   <span style="color: #007700;">2.step(pmax, 1) do |p|</span>
&gt;     <span style="color: #007700;">if items[p &gt;&gt; CharExponent][p &amp; LowMask] == 1</span>
&gt;       <span style="color: #007700;">count += 1</span>
&gt;       <span style="color: #007700;">p.step(pmax, p) do |mult|</span>
&gt;         <span style="color: #007700;">a = mult &gt;&gt; CharExponent</span>
&gt;         <span style="color: #007700;">b = mult &amp; LowMask</span>
&gt;         <span style="color: #007700;">items[a] -= masks[b] if items[a][b] != 0</span>
&gt;       <span style="color: #007700;">end</span>
&gt;     <span style="color: #007700;">end</span>
&gt;   <span style="color: #007700;">end</span>
&gt;   <span style="color: #007700;">count</span>
&gt; <span style="color: #007700;">end</span>
&gt; 
&gt; <span style="color: #007700;">n = 9 # (ARGV[0] || 2).to_i</span>
&gt; <span style="color: #007700;">n.step(n - 2, -1) do |exponent|</span>
&gt;   <span style="color: #007700;">break if exponent &lt; 0</span>
&gt;   <span style="color: #007700;">m = 2 ** exponent * 10_000</span>
&gt;   <span style="color: #007700;">count = sieve(m)</span>
&gt;   <span style="color: #007700;">printf &quot;Primes up to %8d %8d\n&quot;, m, count</span>
&gt; <span style="color: #007700;">end</span>
&gt; 
&gt; 
&gt; <span style="color: #007700;">clean   30256.3521170616</span>
=&gt;  <span style="color: #007700;">504.272535 分</span>

このベンチマークがえらい時間かかっているようなのですが，何かお心当たりの
ある人は居ませんか？　ちょっと異常です．

以前は 5 秒弱で終わっていました．

この clean というのは
ruby 2.0.0dev (2012-11-19 trunk 37722) [x86_64-linux]
です．

nari さんの定点ベンチマークでは，なんか出てます？

-- 
// SASADA Koichi at atdot dot net

<a name=tail></a></pre>
</BODY></HTML>
