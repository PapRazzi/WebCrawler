<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>WikiAttack2013 - Python Wiki</title>
<script type="text/javascript" src="/wiki/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/wiki/europython/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="/wiki/europython/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="/wiki/europython/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="/wiki/europython/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/wiki/europython/css/msie.css">
<![endif]-->


<link rel="alternate" title="Python Wiki: WikiAttack2013" href="/moin/WikiAttack2013?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=WikiAttack2013&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="/moin/FrontPage">
<link rel="Alternate" title="Wiki Markup" href="/moin/WikiAttack2013?action=raw">
<link rel="Alternate" media="print" title="Print View" href="/moin/WikiAttack2013?action=print">
<link rel="Search" href="/moin/FindPage">
<link rel="Index" href="/moin/TitleIndex">
<link rel="Glossary" href="/moin/WordIndex">
<link rel="Help" href="/moin/HelpOnFormatting">
</head>

<body  lang="en" dir="ltr">
<p class="red"><b>Please note:</b> This wiki is
    currently running in test mode after an attack on January 5 2013. 
    <b>All passwords were reset</b>, so you will have to use the <a
    href="?action=recoverpass">password recovery function</a> to get a new
    password.  <b>To edit wiki pages, please log in first.</b> See the <a
    href="/moin/WikiAttack2013">wiki attack description page</a> for more
    details.  If you find problems, please report them to the <a
    href="mailto:pydotorg-www@python.org">pydotorg-www mailing list</a>. 
    </p> 
<div id="header">

<form id="searchform" method="get" action="/moin/WikiAttack2013">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="/moin/FrontPage"></a><a href="http://python.org"><img src="http://www.python.org/images/python-logo.gif" alt="Python" ></a><a name="logo"></a></div>
<div id="locationline">


<ul id="pagelocation">
<li><a class="backlink" href="/moin/WikiAttack2013?action=fullsearch&amp;context=180&amp;value=linkto%3A%22WikiAttack2013%22" rel="nofollow" title="Click to do a full-text search for this title">WikiAttack2013</a></li>
</ul>

</div>

<ul id="pagetrail">
<li><a href="/moin/WikiAttack2013">WikiAttack2013</a></li>
</ul>
</div>

<div id="sidebar">
<div id="star">

</div>
<div class="sidepanel">

<ul id="navibar">
<li class="wikilink"><a href="/moin/FrontPage">FrontPage</a></li><li class="wikilink"><a href="/moin/RecentChanges">RecentChanges</a></li><li class="wikilink"><a href="/moin/FindPage">FindPage</a></li><li class="wikilink"><a href="/moin/HelpContents">HelpContents</a></li><li class="current"><a href="/moin/WikiAttack2013">WikiAttack2013</a></li>
</ul>

</div>
<div class="sidepanel">
<h1>Page</h1>
<ul class="editbar"><li><span class="disabled">Immutable Page</span></li><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbinfo" href="/moin/WikiAttack2013?action=info" rel="nofollow">Info</a></li><li><a class="nbattachments" href="/moin/WikiAttack2013?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="/moin/WikiAttack2013">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="raw">Raw Text</option>
<option value="print">Print View</option>
<option value="refresh">Delete Cache</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="SpellCheck">Check Spelling</option>
<option value="LikePages">Like Pages</option>
<option value="LocalSiteMap">Local Site Map</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="SlideShow">SlideShow</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

</div>
<div class="sidepanel">
<h1>User</h1>
<ul id="username"><li><a href="/moin/WikiAttack2013?action=login" id="login" rel="nofollow">Login</a></li></ul>
</div>
</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867">
<h1 id="Wiki_Attack_January_2013">Wiki Attack January 2013</h1>
<span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867">
<h2 id="Summary">Summary</h2>
<span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line874">The python.org wikis for Python, Jython and the Python Software Foundation (PSF) were subject to a security breach and later attack which caused all of the wiki data to be destroyed on January 5 2013. <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line862">An analysis of the incident revealed that an exploit had been planted on our servers possibly as early as July 25 2012, which allowed arbitrary execution of code under the user running the <a href="/moin/MoinMoin">MoinMoin</a> wiki. <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line862">It is likely that the password information was downloaded from the server in the course of the security breach, so <strong>we recommend changing your passwords immediately</strong>, if you have used the same password for other services as well. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line874">During the recovery in the weeks after the attack, we reset all passwords on the wiki server to make sure that users do change their passwords. You can use the password recovery function of the resp. wiki to reset your password. The function is shown when clicking on the login link. <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line874">If you have created new accounts after June 24 2012, those accounts will no longer exist due to the data loss. You will have to recreate the accounts. <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line862">Moving forward, we will no longer allow changing wiki pages without login and have put additional security measures in place to prevent attacks like the one we came under. The PSF has also funded the change of the <a href="/moin/MoinMoin">MoinMoin</a> code base to include support for the passlib library, which provides much better means of protecting password information on the server than the SHA-1 based hash scheme used before <a href="/moin/MoinMoin">MoinMoin</a> 1.9.6. This new support will be available in <a href="/moin/MoinMoin">MoinMoin</a> 1.9.7. <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line862">Please report any problems you find with the wiki to the <a class="mailto" href="mailto:pydotorg-www@python.org">mailto:pydotorg-www@python.org</a> mailing list. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line867">
<h2 id="Attack_Analysis">Attack Analysis</h2>
<span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line874">In the week of January 14 2013, we ran a longer analysis of the attack on the wiki VM. This is a summary of the things we found. <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line874">The attack used on the wiki was apparently the same as the one which hit Debian: <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><ul><li style="list-style-type:none"><p class="line891"><a class="http" href="http://wiki.debian.org/DebianWiki/SecurityIncident2012">http://wiki.debian.org/DebianWiki/SecurityIncident2012</a> <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span></li></ul><p class="line862">Someone used the <a class="https" href="https://security-tracker.debian.org/tracker/CVE-2012-6081">https://security-tracker.debian.org/tracker/CVE-2012-6081</a> vulnerability to upload an action plugin to the server called moinexec.py, which was then subsequently used to run commands on the moin user account. <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line874">The few logs that were still accessible showed that someone tried sudo on Dec 28 2012, but without success. <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><p class="line874">On Jan 5 at 00:10 GMT, someone else ran the "rm -r *" which resulted in all files owned by the moin user to get deleted. <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><p class="line874">The VM was rebooted on Jan 7, apparently in an attempt to get things working again. The result of this was that the file system was remounted, clearing most of the transaction log, which could have been used to recover the deleted files. The VM image he was working off was created after the reboot. <span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line874">Of course, without the moin user files available, getting a better picture of what happened was difficult. With the knowledge of the Debian analysis, he found a bytecode file of the uploaded plugin code in the VM image and this showed a PYC time stamp of Wed Jul 25 16:08:14 2012 GMT, closely matching the date given in the Debian analysis. <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line874">We were subsequently approached by the person who ran the rm -r *, so we know now that the original attack was performed by different people, most probably the same that attacked the Debian wiki. It is also obvious that the people who installed the plugin, had different intentions than causing easy to detect damage on the system. <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line862">Since the logs on the VM only go back 5 <img alt="(!)" height="16" src="/wiki/europython/img/idea.png" title="(!)" width="16" /> days for server web logs and 7 <img alt="(!)" height="16" src="/wiki/europython/img/idea.png" title="(!)" width="16" /> days for system logs, it was impossible to determine the amount of information leakage caused by the attack. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line874">It is likely that the passwords and user configuration details were inspected in the same way as was done for the Debian wiki. <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><p class="line867">
<h2 id="Content_Recovery">Content Recovery</h2>
<span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><p class="line874">Since we were not in the comfortable position to use a backup for restoring the wiki content (our most recent backup dates back to June 24 2012), we tried to get as much information from archive.org, the Google cache and the Yahoo/Bing cache as possible. <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><p class="line874">It turned out that the Google cache was unusable for the task due to a surge protection on their site. Yahoo/Bing worked and results in quite a few more recent edits/updates. The archive.org pages included snapshots from end of Nov 2012, but they apparently don't run complete dumps of the sites they archive (and since moin has a surge protection built-in as well, it's not easy for such archives to crawl the wiki). <span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><p class="line874">Overall, we have been able to recover around 200 pages that were created/edited after the June 2012 backup date. Not really all that much, given the amount of data in the wiki, but still better than nothing. <span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><p class="line874">We then ran ext4image and photorec on the VM image in several combinations and was able to restore a number of files. Unfortunately, important meta data such as the file date/time and name was lost. This made restoring from the files very difficult. <span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><p class="line874">Moin stores the wiki pages in plain text files and keeps all revisions in the file system. Furthermore, there is no meta information inside the text files, so only the headers from the file content can be used as indication of which page it belongs to and even then, you get multiple copies of the same page, with no indication as to which of those to regard as most current version. <span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><p class="line874">Still, the restored files do contain pages that were not available in the archive web sites, so if there are important pages that need to be restored, we can manually try to extract the relevant data and re-add it to the wikis. For the PSF wiki, this is the only way to recover files, since there are no web archives available for it. <span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><p class="line874">Additionally, none of the newer attachments to wiki pages could be restored. <span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><p class="line867">
<h2 id="Content_Restoration">Content Restoration</h2>
<span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><p class="line874">In the week of January 21, we then continued the work to prepare the archive downloads for reintegration into the wiki. <span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><p class="line862">A script was used which is able to convert the archive HTML dumps back into wiki markup. We also wrote a script which uses the <a href="/moin/MoinMoin">MoinMoin</a> API to readd the pages with proper timestamps and editor information back into the <a href="/moin/MoinMoin">MoinMoin</a> database. <span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><p class="line862">In the meantime, one of the <a href="/moin/MoinMoin">MoinMoin</a> developers was working on adding passlib support to moin 1.9. The work was funded by the Python Software Foundation (PSF). <span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><p class="line874">We then setup a new VM for the wiki and configured it to use the newly added passlib support in moin. After an additional security audit on the configuration and changes to harden the installation, the conversion script was used to readd the archive dumps on top of the June 24 2012 backup. <span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><p class="line874">Note that as part of the recovery process, some pages were changed from ReST markup to wiki markup. This is due to the fact that the restore process via the HTML archive dumps always creates wiki markup. <span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><p class="line867">
<h2 id="Wiki_Cleanup">Wiki Cleanup</h2>
<span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><p class="line874">After the recovery step, we ran a wiki cleanup. This means that "empty" and deleted pages were moved out of the way. <span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><p class="line874">We also changed the user preference settings from the old "python" theme to the current "europython" theme, which is also used for all new accounts. <span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><p class="line867">
<h2 id="Next_Steps">Next Steps</h2>
<span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><p class="line874">After the official moin 1.9.7 release, we will switch from the current moin checkout we're using to the official release. <span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><p class="line874">We will also enable HTTPS access to the wiki to further enhance security and avoid having to send clear text passwords over the network in order to log in to the wikis. <span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><p class="line867">
<h2 id="Timeline">Timeline</h2>
<span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><ul><li>2012-07-24: Likely date of the original exploit installation <span class="anchor" id="line-88"></span></li><li>2013-01-05: All wiki files deleted using the exploit <span class="anchor" id="line-89"></span></li><li>2013-01-07: Wiki server taken down for analysis and recovery <span class="anchor" id="line-90"></span></li><li>2013-01-25: New wiki server switched online in test mode <span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span></li></ul><p class="line867">
<h2 id="Credits">Credits</h2>
<span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><p class="line874">These people have put in significant work to get the wiki back online (in alphabetical order). <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><ul><li>Reimar Bauer (HTML conversion, adding pages to the wiki, security audit, wiki configuration) <span class="anchor" id="line-97"></span></li><li>Noah Kantrowitz (setting up the new VM) <span class="anchor" id="line-98"></span></li><li>Marc-Andre Lemburg (recovering pages from the archives, attack analysis, file recovery, setting up the new installation, security audit, wiki configuration, wiki cleanup) <span class="anchor" id="line-99"></span></li><li><p class="line862">Thomas Waldmann (adding passlib support to <a href="/moin/MoinMoin">MoinMoin</a>, help with the configuration) <span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span></li></ul><p class="line874">-- Python Software Foundation <span class="anchor" id="line-102"></span><span class="anchor" id="bottom"></span></div><p id="pageinfo" class="info" lang="en" dir="ltr">WikiAttack2013  (last edited 2013-02-06 12:39:54 by <span title="MarcAndreLemburg @ ip-62-143-58-220.unitymediagroup.de[62.143.58.220]"><a href="/moin/MarcAndreLemburg" title="MarcAndreLemburg @ ip-62-143-58-220.unitymediagroup.de[62.143.58.220]">MarcAndreLemburg</a></span>)</p>

<div id="pagebottom"></div>
</div>


<div id="footer">
<ul id="credits">
<li><a href="http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>
</html>

