<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html>
  <head>
    <title>How to enable Travis CI for an extension</title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="/styles.css" />
    
    <style type="text/css">
    <!--

    -->
    </style>
  </head>
  <body>
    <div id="header">
      <div id="logo">
        <a href="/"><img src="/images/logo.gif" alt="Radiant - Content Management Simplified"/></a>
      </div>
      <div id="site-links">
<a href="/">Home</a>
<span class="separator"> | </span>
<a href="/demo/">Demo</a> <span class="separator"> | </span> <a href="/download/">Download</a>
<span class="separator"> | </span>
<a href="http://github.com/radiant/radiant/wiki/">Documentation</a>
<span class="separator"> | </span>
<a href="http://ext.radiantcms.org/">Extensions</a>
<span class="separator"> | </span>
<a href="http://github.com/radiant/radiant/">Development</a>
<span class="separator"> | </span>
<a href="/mailing-list/">Mailing List</a> <span class="separator"> | </span> <strong><a href="/blog/">Weblog</a></strong> <span class="separator"> | </span> <a href="/podcast/">Podcast</a>
      </div>
    </div>
    <div id="content">
<h1>How to enable Travis CI for an extension</h1>

<script type="text/javascript" src="http://www.haloscan.com/load/radiantcms"></script>
<div class="info">Posted by John Muhl on Friday, January 06, 2012 | <a href="javascript:HaloScan('blog-how-to-enable-travis-ci-for-an-extension');" target="_self"><script type="text/javascript">postCount('blog-how-to-enable-travis-ci-for-an-extension');</script></a> | <a href="javascript:HaloScanTB('blog-how-to-enable-travis-ci-for-an-extension');" target="_self"><script type="text/javascript">postCountTB('blog-how-to-enable-travis-ci-for-an-extension');</script></a></div>

<p><em>This information is also available on the <a href="https://github.com/radiant/radiant/wiki/How-to-enable-Travis-CI-for-an-extension">wiki</a> where it will receive updates as needed</em>.</p>

<p><a href="http://travis-ci.org/">Travis CI</a> is a flexible and easy to use continuous integration server; see the <a href="http://about.travis-ci.org/docs/user/getting-started/">Getting Started page</a> for more details. The flexibility means that there are any number of ways to setup and test your extensions. Here is one way.</p>

<p>First you need to add a <code>.travis.yml</code> file to the root of your repository.</p>

<pre><code>rvm:
  - 1.8.7
  - 1.9.2
  - 1.9.3

before_script: "./spec/ci/before_script"

script: "./spec/ci/script"

env:
  - RADIANT_VERSION=0.9.1 DB=mysql
  - RADIANT_VERSION=0.9.1 DB=postgres
  - RADIANT_VERSION=1.0.0 DB=mysql
  - RADIANT_VERSION=1.0.0 DB=postgres

notifications:
  recipients:
    - you@example.com
</code></pre>

<p>The <code>rvm</code> array shows the Ruby versions you want to test against; since Radiant 1.0 supports the three latest Ruby releases your extension should too. Likewise the <code>env</code> array list Radiant version/database combinations to test against; the Radiant version can be any <a href="https://github.com/radiant/radiant/tags">tagged version of Radiant</a>.</p>

<p>Next up we need to create the <code>before_script</code> referenced above. The <code>before_script</code> is run before your tests and sets up a complete Radiant environment within which your tests will be run.</p>

<pre><code>cd ~
git clone git://github.com/radiant/radiant.git
cd ~/radiant
if [[ $RADIANT_VERSION != "master" ]]
then
  git checkout -b $RADIANT_VERSION $RADIANT_VERSION
fi
cp -r ~/builds/*/YOUR_REPOSITORY_NAME vendor/extensions/YOUR_EXTENSION_NAME
gem install bundler --pre
bundle install

case $DB in
  "mysql" )
    mysql -e 'create database radiant_test;'
    cp spec/ci/database.mysql.yml config/database.yml;;
  "postgres" )
    psql -c 'create database radiant_test;' -U postgres
    cp spec/ci/database.postgresql.yml config/database.yml;;
esac

bundle exec rake db:migrate
bundle exec rake db:migrate:extensions
</code></pre>

<p>Replace <code>YOUR_REPOSITORY_NAME</code> and <code>YOUR_EXTENSION_NAME</code> in the <code>before_script</code> with the actual name of your repo and extension; e.g. <code>radiant-sheets-extension</code> and <code>sheets</code> respectively. <strong>Don&rsquo;t forget to make this script executable before committing it to your repository</strong>.</p>

<p>Finally we need to create the <code>script</code> file. This is the script that actually executes your tests.</p>

<pre><code>cd ~/radiant
bundle exec rake spec:extensions EXT=YOUR_EXTENSION_NAME
</code></pre>

<p>Again you need to replace <code>YOUR_EXTENSION_NAME</code> with the real thing and <strong>make the script executable</strong>.</p>

<p>All that&rsquo;s left to do is login to <a href="http://travis-ci.org/">Travis</a>, enable the commit-hook for you repository and push. Head over to <a href="http://travis-ci.org/">http://travis-ci.org/</a> and click the &ldquo;Sign in with GitHub&rdquo; link. Once you&rsquo;ve authorized through GitHub visit your profile page on Travis, find the extension to enable and flick the switch to on.</p>

<p>Now you&rsquo;re ready to commit and push the <code>.travis.yml</code>, <code>before_script</code> and <code>script</code> files and let Travis handle the rest. If you want to know more about all the options you have with Travis the <a href="http://about.travis-ci.org/docs/">documentation</a> is very good. You can see an example of this setup in action on the <a href="https://github.com/radiant/radiant-sheets-extension">Sheets</a> extension or check out what it looks like to have your specs run by Travis by visiting the Travis page for <a href="http://travis-ci.org/radiant/radiant-sheets-extension">Sheets</a>. Once setup Travis will run your tests after every commit unless you add <code>[ci skip]</code> to the commit message (which is good practice when pushing documentation or other commits that don&rsquo;t affect functionality).</p>
<div id="extended">

</div>
    </div>
    <div id="footer">
<p>Radiant <span class="caps">CMS</span> was created by <a href="http://wiseheartdesign.com/">John W. Long</a>, extended by <a href="http://seancribbs.com">Sean Cribbs</a>, and has been continuously improved by a <a href="https://github.com/radiant">team of core committers</a> with dozens of additional contributions from the Radiant community.</p>
<p>This site is made with <a href="http://ruby-lang.org">Ruby</a> and powered by Radiant. Hosting is graciously provided by the kind folks at <a href="http://avlux.net"><span class="caps">AVLUX</span></a>.</p>
<p>Web Site Design, Logo, Etc. Copyright &copy; 2006&#8211;2013, John W. Long. All Rights Reserved.</p>
    </div>
    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-301205-1";
urchinTracker();
</script>
    <script type="text/javascript">
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4e09fee9f5a1f50f03000001');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
  </body>
</html>